<mat-card style="margin-top: 12px">
  <mat-card-header>
    <mat-card-title>
      {{
        store.competicion()?.label?.includes(store.categoria()?.label!)
          ? ""
          : store.categoria()?.label + "-"
      }}
      {{ store.competicion()?.label }}
    </mat-card-title>
    <mat-card-subtitle>
      {{ store.fase()?.label }}
      {{
        store.temporada() ? "(" + store.temporada()?.label + ")" : ""
      }}</mat-card-subtitle
    >
    <span class="spacer"></span>
    <mat-form-field
      class="selector-jornada"
      appearance="fill"
      tourAnchor="select-jornada"
    >
      <mat-label>Jornada</mat-label>
      <mat-select
        [disabled]="!store.fase() || store.jornadas().length === 0"
        [value]="store.jornada()"
        [compareWith]="compareByCode"
        (selectionChange)="store.setJornada($event.value)"
      >
        @for (s of store.jornadas(); track s.code) {
        <mat-option [value]="s"
          >{{ s.label }}
          {{
            s.code === store.jornadaActual()?.code ? "(Actual)" : ""
          }}</mat-option
        >
        }
      </mat-select>
    </mat-form-field>
  </mat-card-header>
  <mat-card-content>
    <div class="report">
      @if (!store.fase() ) {
      <mat-icon class="ill" fontSet="material-symbols-outlined"
        >search_insights</mat-icon
      >
      <h3>Selecciona una fase</h3>
      <p>
        Elige territorial, temporada, categoría y competición para ver los
        partidos o la clasificación.
      </p>

      <div class="actions">
        <button mat-flat-button color="primary" (click)="openMenu()">
          <mat-icon>menu</mat-icon>
          Abrir menú
        </button>
        <button mat-stroked-button color="primary" routerLink="/">
          Limpiar selección
        </button>
      </div>
      } @else if (loading()) {
      <div class="loading">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
      <div class="skeleton-list" aria-hidden="true">
        @for (_ of [1,2,3,4,5,6,7,8,9,10,11,12]; track _) {
        <div class="skeleton-item">
          <div class="sk-logo shimmer"></div>
          <div class="sk-lines">
            <div class="sk-line shimmer"></div>
            <div class="sk-line short shimmer"></div>
          </div>
          <div class="sk-score shimmer"></div>
        </div>
        }
      </div>
      } @else if ( partidos().length === 0) {
      <div class="empty">
        <mat-icon>event_busy</mat-icon>
        <p>No hay partidos para esta jornada.</p>
      </div>
      } @else {
      <div>
        @for(p of partidos(); track p.code) {
        <article class="match-card mat-elevation-z1">
          <header class="match-head">
            <span
              class="date"
              [tourAnchor]="$index === 0 ? 'fecha-partido' : ''"
              >{{ date(p) }}</span
            >
            <span
              class="status"
              [tourAnchor]="$index === 0 ? 'estado-partido' : ''"
              [class.played]="p.estado === 'FINAL'"
              >{{ p.estado }}</span
            >
          </header>

          <div class="teams">
            <div class="team local">
              <span class="name" (click)="detalle(p.local)">{{
                p.local.label
              }}</span>
              <img
                [src]="p.local.logo"
                (click)="detalle(p.local)"
                alt=""
                class="logo"
              />
            </div>
            <div class="versus">vs</div>
            <div class="team visitante">
              <img
                [src]="p.visitante.logo"
                (click)="detalle(p.visitante)"
                alt=""
                class="logo"
              />
              <span class="name" (click)="detalle(p.visitante)">{{
                p.visitante.label
              }}</span>
            </div>
          </div>

          <div class="footer">
            <div
              class="place"
              [tourAnchor]="$index === 0 ? 'lugar-partido' : ''"
            >
              <mat-icon>location_on</mat-icon>
              <span>{{ p.lugar?.label ?? "PDTE." }}</span>
            </div>

            <div
              class="score"
              [class.pending]="
                p.puntosLocal == null || p.puntosVisitante == null
              "
              [tourAnchor]="$index === 0 ? 'resultado-partido' : ''"
            >
              @if (p.puntosLocal != null && p.puntosVisitante != null) {
              <span class="pill"
                >{{ p.puntosLocal }} - {{ p.puntosVisitante }}</span
              >
              } @else {
              <span class="pill ghost">Pendiente</span>
              }
            </div>
          </div>
        </article>
        }
      </div>
      }
    </div>
  </mat-card-content>
</mat-card>
